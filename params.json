{"name":"Weixinapi","tagline":"专门用于微信公众平台的Javascript API - forked from zxlie/WeixinApi","body":"微信公众平台Js API（WeixinApi）\r\n=======================================\r\n\r\n## 关于WeixinApi\r\n### 1、WeixinApi为何诞生\r\n以前顺便玩儿了下微信公众账号，做Web前端开发的，都对页面脚本充满好奇，所以研究了下，放到[`Blog`](http://www.baidufe.com)上，\r\n也正因为微信官方一直没有放出正式的Api提供给用户来用，所以大量的用户到我blog上去询问`WeixinJSBridge`相关的技术点，索性我就整理了一下，\r\n起个名字叫`WeixinApi`开源到github来，提供给大家使用！\r\n\r\n### 2、免责声明\r\n此Api为`非官方`版，由于官方的限制，继续使用此Api还有可能会出现一些意向不到的问题，一切后果请自行承担！\r\n\r\n### 3、WeixinApi可能停止更新\r\n目前官方已经出了正式版本的SDK，详情可见[微信JS-SDK说明文档](http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html),\r\n所以大家还是尽早迁移到官方版本吧，这对大家来说是好事，以后出什么问题，官方渠道应该都会第一时间给出解决方案，稳定很多，也不至于经常被黑！\r\n本API可能以后就不会频繁更新了，各位知晓！\r\n\r\n## 目录\r\n* [快速使用](#user-content-快速使用)\r\n* [详细Api列表](#user-content-详细api列表)\r\n    * [1、初始化等待分享](#user-content-1初始化等待分享)\r\n    * [2、隐藏右上角option menu入口](#user-content-2隐藏右上角option-menu入口)\r\n    * [3、隐藏底部工具栏](#user-content-3隐藏底部工具栏)\r\n    * [4、获取当前的网络类型](#user-content-4获取当前的网络类型)\r\n    * [5、调起客户端图片播放组件](#user-content-5调起客户端图片播放组件)\r\n    * [6、关掉当前微信公众页面窗口](#user-content-6关掉当前微信公众页面窗口)\r\n    * [7、判断当前网页是否在微信内置浏览器中打开](#user-content-7判断当前网页是否在微信内置浏览器中打开)\r\n    * [8、开启WeixinApi的错误监控](#user-content-8开启weixinapi的错误监控)\r\n    * [9、发送电子邮件](#user-content-9发送电子邮件)\r\n    * [10、禁止用户分享](#user-content-10禁止用户分享)\r\n* [常见问题](#user-content-常见问题)\r\n* [其他](#user-content-其他)\r\n\r\n你可以用微信的“扫一扫”来打开下面这个二维码体验一下：\r\n\r\n![Weixin Api Demo](http://www.baidufe.com/upload/images/2014-06-14_3.47.02.png)\r\n\r\n## 快速使用\r\n```javascript\r\n// 定义微信分享的数据\r\nvar wxData = {\r\n    \"appId\": \"\", // 服务号可以填写appId\r\n    \"imgUrl\" : 'http://photocdn.sohu.com/20130122/Img364302298.jpg',\r\n    \"link\" : 'http://www.baidufe.com',\r\n    \"desc\" : '使用警告：此Api非官方版本，请各位尽量将分享功能迁移至腾讯官方版，会更稳定些！',\r\n    \"title\" : \"欢迎使用WeixinApi\"\r\n};\r\n\r\n// 分享的回调\r\nvar wxCallbacks = {\r\n    // 收藏操作是否触发回调，默认是开启的\r\n    favorite : false,\r\n\r\n    // 分享操作开始之前\r\n    ready : function() {\r\n        // 你可以在这里对分享的数据进行重组\r\n        alert(\"准备分享\");\r\n    },\r\n    // 分享被用户自动取消\r\n    cancel : function(resp) {\r\n        // 你可以在你的页面上给用户一个小Tip，为什么要取消呢？\r\n        alert(\"分享被取消，msg=\" + resp.err_msg);\r\n    },\r\n    // 分享失败了\r\n    fail : function(resp) {\r\n        // 分享失败了，是不是可以告诉用户：不要紧，可能是网络问题，一会儿再试试？\r\n        alert(\"分享失败，msg=\" + resp.err_msg);\r\n    },\r\n    // 分享成功\r\n    confirm : function(resp) {\r\n        // 分享成功了，我们是不是可以做一些分享统计呢？\r\n        alert(\"分享成功，msg=\" + resp.err_msg);\r\n    },\r\n    // 整个分享过程结束\r\n    all : function(resp,shareTo) {\r\n        // 如果你做的是一个鼓励用户进行分享的产品，在这里是不是可以给用户一些反馈了？\r\n        alert(\"分享\" + (shareTo ? \"到\" + shareTo : \"\") + \"结束，msg=\" + resp.err_msg);\r\n    }\r\n};\r\n// 自定义分享到：微信好友、朋友圈、腾讯微博、QQ好友\r\nWeixinApi.share(wxData,wxCallbacks);\r\n```\r\n\r\n可下载源码，部署sample/sample-new.html进行测试\r\n\r\n## 详细Api列表\r\n使用起来比较简单，具体可参考sample/sample-normal.html中的实现\r\n\r\n### 1、初始化等待分享\r\n```javascript\r\n// 开发阶段，开启WeixinApi的调试模式\r\nWeixinApi.enableDebugMode();\r\n\r\n// 初始化WeixinApi，等待分享\r\nWeixinApi.ready(function(Api) {\r\n\r\n    // 微信分享的数据\r\n    var wxData = {\r\n        \"appId\": \"\", // 服务号可以填写appId\r\n        \"imgUrl\" : 'http://www.baidufe.com/fe/blog/static/img/weixin-qrcode-2.jpg',\r\n        \"link\" : 'http://www.baidufe.com',\r\n        \"desc\" : '使用警告：此Api非官方版本，请各位尽量将分享功能迁移至腾讯官方版，会更稳定些！',\r\n        \"title\" : \"欢迎使用WeixinApi\"\r\n    };\r\n\r\n    // 分享的回调\r\n    var wxCallbacks = {\r\n        // 收藏操作不执行回调，默认是开启(true)的\r\n        favorite : false,\r\n\r\n        // 分享操作开始之前\r\n        ready : function() {\r\n            // 你可以在这里对分享的数据进行重组\r\n            alert(\"准备分享\");\r\n        },\r\n        // 分享被用户自动取消\r\n        cancel : function(resp) {\r\n            // 你可以在你的页面上给用户一个小Tip，为什么要取消呢？\r\n            alert(\"分享被取消，msg=\" + resp.err_msg);\r\n        },\r\n        // 分享失败了\r\n        fail : function(resp) {\r\n            // 分享失败了，是不是可以告诉用户：不要紧，可能是网络问题，一会儿再试试？\r\n            alert(\"分享失败，msg=\" + resp.err_msg);\r\n        },\r\n        // 分享成功\r\n        confirm : function(resp) {\r\n            // 分享成功了，我们是不是可以做一些分享统计呢？\r\n            alert(\"分享成功，msg=\" + resp.err_msg);\r\n        },\r\n        // 整个分享过程结束\r\n        all : function(resp,shareTo) {\r\n            // 如果你做的是一个鼓励用户进行分享的产品，在这里是不是可以给用户一些反馈了？\r\n            alert(\"分享\" + (shareTo ? \"到\" + shareTo : \"\") + \"结束，msg=\" + resp.err_msg);\r\n        }\r\n    };\r\n\r\n    // 用户点开右上角popup菜单后，点击分享给好友，会执行下面这个代码\r\n    Api.shareToFriend(wxData, wxCallbacks);\r\n\r\n    // 点击分享到朋友圈，会执行下面这个代码\r\n    Api.shareToTimeline(wxData, wxCallbacks);\r\n\r\n    // 点击分享到腾讯微博，会执行下面这个代码\r\n    Api.shareToWeibo(wxData, wxCallbacks);\r\n\r\n    // iOS上，可以直接调用这个API进行分享，一句话搞定\r\n    Api.generalShare(wxData,wxCallbacks);\r\n});\r\n```\r\n\r\n可能有的朋友不知道appId从哪儿获取，请看这里：[如何获取appId](http://jingyan.baidu.com/article/6525d4b12af618ac7c2e9468.html)\r\n\r\n**分享的数据可以动态修改：**\r\n\r\n* 普通模式分享：分享的数据是固定的，代码请参考 [sample/sample-normal.html](https://github.com/zxlie/WeixinApi/blob/master/sample/sample-normal.html)\r\n* 异步模式分享：分享的数据是可以被动态修改的，代码请参考 [sample/sample-normal.html](https://github.com/zxlie/WeixinApi/blob/master/sample/sample-async.html)\r\n\r\n\r\n### 2、隐藏右上角option menu入口\r\n```javascript\r\nWeixinApi.ready(function(Api) {\r\n\t// 隐藏\r\n\tApi.hideOptionMenu();\r\n\t\r\n\t// 显示\r\n\t// Api.showOptionMenu();\r\n});\r\n```\r\n\r\n### 3、隐藏底部工具栏\r\n```javascript\r\nWeixinApi.ready(function(Api) {\r\n\t// 隐藏\r\n\tApi.hideToolbar();\r\n\t\r\n\t// 显示\r\n\t// Api.showToolbar();\r\n});\r\n```\r\n\r\n### 4、获取当前的网络类型\r\n```javascript\r\nWeixinApi.ready(function(Api) {\r\n\tApi.getNetworkType(function(network){\r\n\t\t/**\r\n\t\t * network取值：\r\n\t\t *\r\n\t\t * network_type:wifi     wifi网络\r\n\t     * network_type:edge     非wifi,包含3G/2G\r\n\t     * network_type:fail     网络断开连接\r\n\t     * network_type:wwan     2g或者3g\r\n\t     */\r\n\t});\r\n});\r\n```\r\n\r\n### 5、调起客户端图片播放组件\r\n```javascript\r\nWeixinApi.ready(function(Api) {\r\n\t// 需要播放的图片src list\r\n\tvar srcList = [src1, src2, ..., srcN];\r\n\t// 选一个作为当前需要展示的图片src\r\n\tvar curSrc = src1;\r\n\t// 调起\r\n\tApi.imagePreview(curSrc, srcList);\r\n});\r\n```\r\n\r\n调起客户端图片播放组件，还有一种更屌的方法，不需要依赖这个WeixinApi，直接a标签实现就行，具体格式：\r\n\r\n\r\n\t<a href=\"weixin://viewimage/`YourImageURL`\">AnyThing</a>\r\n\r\n\r\n我们可以用A标签来嵌套这个img，具体Demo如下：\r\n\r\n```html\r\n<a href=\"weixin://viewimage/http://www.baidu.com/img/bdlogo.gif\">\r\n\t<img src=\"http://www.baidu.com/img/bdlogo.gif\">\r\n</a>\r\n<a href=\"weixin://viewimage/http://tb2.bdstatic.com/tb/static-common/img/search_logo_big_6a13b553.gif\">\r\n\t<img src=\"http://tb2.bdstatic.com/tb/static-common/img/search_logo_big_6a13b553.gif\">\r\n</a>\r\n```\r\n\r\n### 6、关掉当前微信公众页面窗口\r\n```javascript\r\nWeixinApi.ready(function(Api) {\t\r\n\t// 关闭窗口\r\n    WeixinApi.closeWindow({\r\n        success : function(resp){\r\n            alert('关闭窗口成功！');\r\n        },\r\n        fail : function(resp){\r\n            alert('关闭窗口失败');\r\n        }\r\n    });\r\n});\r\n```\r\n\r\n### 7、判断当前网页是否在微信内置浏览器中打开\r\n```javascript\r\n\r\n\t// true or false\r\n\tvar flag = WeixinApi.openInWeixin();\r\n\r\n```\r\n\r\n### 8、开启WeixinApi的错误监控\r\n注意，这句代码务必放在WeixinApi.ready之前；上线的时候，根据实际需要，可删掉它\r\n\r\n```javascript\r\n// 方法1：不带任何参数，将以alert方式提示出错信息\r\nWeixinApi.enableDebugMode();\r\n\r\n// 方法2：给一个callback，自己处理错误信息\r\nWeixinApi.enableDebugMode(function(errObj){\r\n    // errObj = {\r\n    //     message : errorMessage,\r\n    //     script : scriptURI,\r\n    //     line : lineNumber,\r\n    //     column : columnNumber\r\n    // }\r\n});\r\n\r\n// 当然，你还可以做一件事：把这些错误信息上报到服务器\r\n```\r\n\r\n### 9、发送电子邮件\r\n```javascript\r\nWeixinApi.sendEmail({\r\n    subject : '邮件标题',\r\n    body : '邮件正文'\r\n},function(resp){\r\n    // 注意这里可不要轻易alert，会卡死的。。。\r\n});\r\n```\r\n\r\n### 10、禁止用户分享\r\n```javascript\r\n// 先对Api进行初始化\r\nWeixinApi.ready(function(Api) {\r\n    // 禁止分享\r\n    Api.disabledShare(function(){\r\n        alert('当前页面禁止分享！');\r\n    });\r\n});\r\n```\r\n\r\n代码请参考 [sample/sample-normal.html](https://github.com/zxlie/WeixinApi/blob/master/sample/sample-disable.html)\r\n\r\n## 常见问题\r\n### 1、用了这个API怎么没生效\r\n如果遇到这种情况，请先回到这里，扫描最上面的 [二维码](#user-content-api能实现什么) Demo，首先验证Demo是否能运行正确；然后再参照demo.html调整自己的代码：\r\n\r\n* 1）、`WeixinApi.js`路径是否引用正确\r\n* 2）、`WeixinApi.ready`是否正确执行了？（可以在里面加一个alert，简单粗暴可依赖）\r\n* 3）、开启`WeixinApi.enableDebugMode`方便问题定位\r\n\r\n### 2、Android上取消分享依然提示成功\r\n传送门：[为什么分享到朋友圈，取消了依然提示成功？](http://www.baidufe.com/item/4bdcde11a024c63df3af.html)\r\n\r\n### 3、想自己做一个按钮直接分享\r\n就我目前了解到的情况来看，是行不通的，官方都有做权限控制，感兴趣可以到这里[去翻一下评论](http://www.baidufe.com/item/f07a3be0b23b4c9606bb.html#content)\r\n\r\n### 4、怎样动态修改分享的信息：wxData\r\n用到Api提供的`async:true`配置，具体可阅读[这里的使用介绍](http://www.baidufe.com/item/f07a3be0b23b4c9606bb.html)\r\n\r\n### 5、收藏的时候为什么也执行分享的回调了？\r\n请在wxCallbacks中设置`favorite:false`，关闭收藏操作的callback\r\n\r\n## 其他\r\n### 1、更多互动\r\n详细的使用场景，还可以到这里获取：http://www.baidufe.com/item/f07a3be0b23b4c9606bb.html\r\n\r\n注意：这只是发烧版本，非微信官方出品！有问题可大家一起来讨论，我很乐意与大家一起来完善这个API。\r\n\r\n### 2、招聘广告\r\n鄙人目前在美丽说商业产品前端团队，队里缺靠谱的FE，欢迎推荐或自荐：http://www.baidufe.com/item/25ea3376a893619eea8c.html\r\n\r\n### 3、如果你觉得这个Api对你有用：\r\n![alien-alipay-qrcode-256.png](http://www.baidufe.com/upload/images/2014-11-03_21-19-40_5.png)\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}